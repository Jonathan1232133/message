<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Чат с Джейкобом Миллером</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0e0f14;
      --phone:#181a20;
      --phone-edge:#101218;
      --accent:#5865f2;
      --me:#3e4563;
      --other:#e9e9ff;
      --text:#e9e9ee;
      --muted:#9aa0a6;
      --shadow:0 20px 60px rgba(0,0,0,.55);
      --radius:34px;
      --trans:220ms cubic-bezier(.2,.8,.2,1);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(60vmax 60vmax at 10% 20%, rgba(88,101,242,.15), transparent 55%),
        radial-gradient(80vmax 70vmax at 90% 80%, rgba(0,195,255,.12), transparent 60%),
        linear-gradient(180deg,#0b0c10,#0e0f14 45%, #0b0c10);
      color:var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .phone-wrap{
      position:relative;
      width:380px; max-width:96vw;
      aspect-ratio:9/16;
      background:linear-gradient(180deg, var(--phone), #15171d);
      border-radius:calc(var(--radius) + 6px);
      box-shadow: var(--shadow);
      padding:12px;
      border:1px solid rgba(255,255,255,.06);
      isolation:isolate;
    }
    .phone-edge{
      position:absolute; inset:-10px;
      border-radius:calc(var(--radius) + 12px);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.35));
      filter:blur(14px);
      opacity:.4; z-index:-1;
      pointer-events:none;
    }
    .notch{
      position:absolute; top:8px; left:50%; transform:translateX(-50%);
      width:140px; height:22px; background:#0b0c11; border-radius:0 0 16px 16px;
      box-shadow: inset 0 -1px 0 rgba(255,255,255,.06), 0 6px 12px rgba(0,0,0,.3);
    }
    .cam{
      position:absolute; top:16px; left:calc(50% - 40px);
      width:8px; height:8px; background:#0a0c10; border-radius:50%;
      box-shadow: inset 0 0 0 2px #0f1116, 0 0 6px rgba(0,0,0,.6);
    }
    .speaker{
      position:absolute; top:16px; left:50%; transform:translateX(-50%);
      width:48px; height:6px; background:#0a0c10; border-radius:6px;
      box-shadow: inset 0 0 0 2px #0f1116, 0 0 6px rgba(0,0,0,.4);
    }
    .phone{
      position:relative; inset:0;
      background:linear-gradient(180deg, #161820, #14161b);
      border-radius:var(--radius);
      display:flex; flex-direction:column;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.05);
    }
    .header{
      display:flex; align-items:center; justify-content:center;
      gap:8px; padding:14px 16px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,0));
      position:relative;
    }
    .title{
      font-weight:700; letter-spacing:.3px; color:#d9d9e3;
      font-size:15.5px; text-align:center;
    }
    .status{
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      font-size:12px; color:var(--muted);
    }
    .chat{
      flex:1; overflow:auto; padding:14px 14px 6px;
      display:flex; flex-direction:column; gap:10px;
      scroll-behavior:smooth;
    }
    .date{
      align-self:center;
      font-size:12.5px; color:var(--muted);
      padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.06);
      backdrop-filter: blur(6px);
    }
    .row{ display:flex; flex-direction:column; gap:6px; }
    .bubble{
      max-width:78%;
      padding:10px 12px;
      border-radius:18px;
      font-size:15.5px; line-height:1.35;
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
      opacity:0; transform:translateY(6px) scale(.98);
      animation: pop-in var(--trans) forwards;
    }
    .me{ align-self:flex-end; background:var(--me); color:#f3f4f7;
      border-bottom-right-radius:6px; }
    .other{ align-self:flex-start; background:var(--other); color:#1c1f2a;
      border-bottom-left-radius:6px; }
    @keyframes pop-in{
      to { opacity:1; transform:translateY(0) scale(1); }
    }
    .sender{display:none;}
    .typing{
      display:flex; align-items:center; gap:8px;
      align-self:flex-start;
      background:rgba(233,233,255,.95);
      color:#1c1f2a;
      border-radius:18px; padding:8px 12px;
      border-bottom-left-radius:6px;
      box-shadow: 0 6px 18px rgba(0,0,0,.2);
      opacity:0; transform:translateY(6px) scale(.98);
      animation: pop-in var(--trans) forwards;
    }
    .typing .dots{
      display:inline-flex; gap:4px; align-items:center; height:10px;
    }
    .dot{
      width:6px; height:6px; border-radius:50%; background:#6c73c9;
      opacity:.5; transform:translateY(0);
      animation: blink 1200ms infinite ease-in-out;
    }
    .dot:nth-child(2){ animation-delay:120ms; }
    .dot:nth-child(3){ animation-delay:240ms; }
    @keyframes blink{
      0%, 60%, 100% { transform:translateY(0); opacity:.4; }
      30% { transform:translateY(-3px); opacity:1; }
    }
    .input{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.06);
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,0));
    }
    .field{
      flex:1; padding:10px 12px; border-radius:14px;
      background:#0f1117; color:#cfd3dc; border:1px solid rgba(255,255,255,.06);
      font-size:14.5px; outline:none;
      min-height: 22px; /* всегда показывает caret, даже если поле пустое! */
      caret-color: #cfd3dc;
      transition:background 0.2s;
    }
    .field[contenteditable="false"]{
      color: #888;
      background:#0f1117;
      cursor: default;
      caret-color: transparent !important;
    }
    .btn{
      background:var(--accent); color:white; border:none;
      padding:10px 12px; border-radius:12px; font-weight:600;
      cursor:pointer; transition: filter var(--trans), transform var(--trans);
    }
    .btn:active{ transform:translateY(1px); }
    .btn:hover{ filter:brightness(1.05); }
    .chat::-webkit-scrollbar{ width:10px }
    .chat::-webkit-scrollbar-thumb{
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border-radius:999px;
    }
    @media (max-width:400px){
      .phone-wrap{ width:360px }
      .bubble{ max-width:82% }
    }
  </style>
</head>
<body>
  <div class="phone-wrap">
    <div class="phone-edge"></div>
    <div class="notch"></div>
    <div class="cam"></div>
    <div class="speaker"></div>
    <div class="phone" aria-label="Смартфон с чатом">
      <div class="header">
        <div class="title">Чат с Джейкобом Миллером</div>
        <div class="status" id="status">в сети</div>
      </div>
      <div class="chat" id="chat">
        <div class="date">08.10</div>
        <div class="row"><div class="bubble me">Пошли гулять?</div></div>
        <div class="date">09.10</div>
        <div class="row"><div class="bubble me">Я теперь в чёрном списке?</div></div>
        <div class="date">16.10</div>
        <div class="row"><div class="bubble me">Эй, ты совсем исчез? Неделю ни слуху ни духу</div></div>
        <div class="date">Сегодня в 22:00</div>
        <div class="row"><div class="bubble other">Привет, не спишь?</div></div>
      </div>
      <div class="input" aria-hidden="true">
        <div class="field" contenteditable="false" role="textbox" aria-label="Поле ввода (демо)">Сообщение…</div>
        <button class="btn" type="button">Отпр.</button>
      </div>
    </div>
  </div>
  <audio id="notification" src="notification.mp3" preload="auto"></audio>
  <audio id="type" src="type.mp3" preload="auto"></audio>
  <script>
    const chat = document.getElementById('chat');
    const statusEl = document.getElementById('status');
    const notification = document.getElementById('notification');
    const typeAudio = document.getElementById('type');
    const inputDiv = document.querySelector('.input');
    let field = inputDiv.querySelector('.field');
    const btn = inputDiv.querySelector('.btn');

    function scrollToBottom(){ chat.scrollTop = chat.scrollHeight; }
    function playNotification(){
      try { notification.currentTime = 0; notification.volume = .7; notification.play().catch(()=>{});} catch(e){}
    }
    function playType(){
      try { typeAudio.currentTime = 0; typeAudio.volume = .5; typeAudio.play().catch(()=>{});} catch(e){}
    }
    function addTyping(){
      statusEl.textContent = "печатает…";
      const row = document.createElement('div');
      row.className = 'row';
      const typing = document.createElement('div');
      typing.className = 'typing';
      const dots = document.createElement('div');
      dots.className = 'dots';
      dots.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      typing.appendChild(dots);
      row.appendChild(typing);
      chat.appendChild(row);
      scrollToBottom();
      return row;
    }
    function removeTyping(row){
      if(row && row.parentNode){ row.parentNode.removeChild(row); }
      statusEl.textContent = "в сети";
    }
    function addMessage({date=null, text="", side='other', delay=0}){
      return new Promise(resolve=>{
        setTimeout(()=>{
          if(date){
            const d = document.createElement('div');
            d.className = 'date';
            d.textContent = date;
            chat.appendChild(d);
          }
          const wrap = document.createElement('div');
          wrap.className = 'row';
          const b = document.createElement('div');
          b.className = 'bubble ' + (side === 'me' ? 'me' : 'other');
          b.textContent = text;
          wrap.appendChild(b);
          chat.appendChild(wrap);
          playNotification();
          scrollToBottom();
          resolve();
        }, delay);
      });
    }

    function setFieldEditable(state, text) {
      field.contentEditable = state ? "true" : "false";
      field.textContent = text || (state ? "" : "Сообщение…");
      if(state) setTimeout(()=>field.focus(),10);
    }

    window.addEventListener('load', ()=>{
      setTimeout(async ()=>{
        const typing1 = addTyping();
        setTimeout(async ()=>{
          removeTyping(typing1);
          await addMessage({
            date:'Сегодня в 22:00',
            text:'Загляни ко мне сегодня, если получится.',
            side:'other',
            delay:120
          });
          showTypeSequence("Ну и где ты пропадал?", 'Сегодня в 22:01', proceedJacobReply);
        }, 3000);
      }, 1000);
    });

    function showTypeSequence(phrase, printDate, callback){
      setFieldEditable(true,"");
      btn.disabled = false;
      let progress = 0;
      let sent = false;

      function keyHandler(e){
        if(sent) return;
        e.preventDefault();
        if(progress < phrase.length){
          field.textContent += phrase[progress];
          playType();
          progress++;
        }
        if(progress === phrase.length && !sent){
          setTimeout(finishMessage, 700);
        }
      }
      field.onkeydown = keyHandler;
      btn.onclick = finishMessage;
      function finishMessage(){
        if(sent) return;
        sent = true;
        setFieldEditable(false, "Сообщение…");
        addMessage({ date: printDate, text: phrase, side: 'me', delay: 100 });
        field.onkeydown = null;
        btn.onclick = null;
        setTimeout(callback, 600);
      }
    }

    function proceedJacobReply(){
      const typing2 = addTyping();
      setTimeout(async ()=>{
        removeTyping(typing2);
        await addMessage({
          date:'Сегодня в 22:01',
          text:'Так только сейчас освободился, сорри',
          side:'other',
          delay:120
        });
        showTypeSequence("Ладно, сейчас зайду, я тут недалеко", 'Сегодня в 22:01', endInput);
      }, 1000);
    }

    function endInput(){
      setFieldEditable(false, "Сообщение…");
      field.onkeydown = null;
      btn.disabled = true;
    }
  </script>
</body>
</html>
